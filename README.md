# Devbox for Gutenberg hacking

This runs WordPress instances for developing and testing [Gutenberg](https://github.com/WordPress/gutenberg/) like the project‚Äôs own wp-env setup but without needing to run Docker.

This doesn‚Äôt include the Gutenberg repo itself. The setup script needs to know the location where you keep yours and that can be configured at `env.GUTENBERG_REPO` in the `devbox.json` file.

Given devbox is installed (see [Getting Started](#getting-started)) to ready the environment run:
```
devbox services up -b
devbox run setup_db
devbox run setup_wp
```

That should be it üçæ.

## Development Status
It‚Äôs mostly working. Not all e2e tests pass but the vast majority do.

<!-- gen-readme start - generated by https://github.com/jetpack-io/devbox/ -->
## Getting Started
This project uses [devbox](https://github.com/jetpack-io/devbox) to manage its development environment.

Install devbox:
```sh
curl -fsSL https://get.jetpack.io/devbox | bash
```

Start the devbox shell:
```sh 
devbox shell
```

Run a script in the devbox environment:
```sh
devbox run <script>
```
## Scripts
Scripts are custom commands that can be run using this project's environment. This project has the following scripts:

* [setup_db](#devbox-run-setup_db)
* [setup_wp](#devbox-run-setup_wp)
* [test](#devbox-run-test)

## Environment

```sh
GUTENBERG_REPO="~/Repos/gutenberg"
MYSQL_BASEDIR="/Users/m/Repos/devbox-gutenberg/.devbox/nix/profile/default"
MYSQL_DATADIR="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/data"
MYSQL_HOME="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/run"
MYSQL_PID_FILE="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/run/mysql.pid"
MYSQL_UNIX_PORT="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/run/mysql.sock"
NGINX_CONF="/Users/m/Repos/devbox-gutenberg/devbox.d/nginx/nginx.conf"
NGINX_CONFDIR="/Users/m/Repos/devbox-gutenberg/devbox.d/nginx"
NGINX_DEV_PORT="8888"
NGINX_DEV_ROOT="../../../devbox.d/web/dev-wp"
NGINX_PATH_PREFIX="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/nginx"
NGINX_TEST_PORT="8889"
NGINX_TEST_ROOT="../../../devbox.d/web/test-wp"
NGINX_TMPDIR="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/nginx/temp"
NGINX_WEB_PORT="80"
NGINX_WEB_ROOT="../../../devbox.d/web"
NGINX_WEB_SERVER_NAME="localhost"
PHPFPM_ERROR_LOG_FILE="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/php/php-fpm.log"
PHPFPM_PID_FILE="/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/php/php-fpm.pid"
PHPFPM_PORT="8082"
PHPRC="/Users/m/Repos/devbox-gutenberg/devbox.d/php"
WP_CLI_CACHE_DIR="~/Library/Caches"
```

## Shell Init Hook
The Shell Init Hook is a script that runs whenever the devbox environment is instantiated. It runs 
on `devbox shell` and on `devbox run`.
```sh
bash /Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/setup_db.sh
echo 'Welcome to devbox!' > /dev/null
```

## Packages

* path:/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/php/flake
* path:/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/php/flake#composer
* [gettext@latest](https://www.nixhub.io/packages/gettext)
* [gawk@latest](https://www.nixhub.io/packages/gawk)
* path:/Users/m/Repos/devbox-gutenberg/.devbox/virtenv/mysql80/flake
* [nginx@latest](https://www.nixhub.io/packages/nginx)
* [wp-cli@latest](https://www.nixhub.io/packages/wp-cli)

## Script Details

### devbox run setup_db
```sh
mysql -u root < setup_db.sql
```
&ensp;

### devbox run setup_wp
```sh
./setup_wp.sh
```
&ensp;

### devbox run test
```sh
echo "Error: no test specified" && exit 1
```
&ensp;



<!-- gen-readme end -->
